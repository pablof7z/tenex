#!/bin/bash

# Script to open a task file in VS Code and trigger the roo-executor extension

# --- Configuration ---
# Delay in seconds before triggering the VS Code command URI (allows VS Code to open)
VSCODE_URI_DELAY=2

# --- Main Script ---

# Check if both arguments are provided
if [ -z "$1" ] || [ -z "$2" ]; then
  echo "Usage: $0 <project_dir_path> <task_file_path>"
  exit 1
fi

PROJECT_DIR_PATH="$1"
TASK_FILE_PATH="$2"

echo "Project directory path: $PROJECT_DIR_PATH"
echo "Task file path: $TASK_FILE_PATH"

# Check if the file exists
if [ ! -f "$TASK_FILE_PATH" ]; then
  echo "Error: File '$TASK_FILE_PATH' not found."
  exit 1
fi

# Get the task file's containing directory (for reference)
TASK_DIR_PATH="$(dirname "$TASK_FILE_PATH")"
echo "Project directory: $PROJECT_DIR_PATH"
echo "Task directory: $TASK_DIR_PATH"

# Open the directory in VS Code
code "$PROJECT_DIR_PATH"

if [ $? -ne 0 ]; then
  echo "Error: Failed to open directory with 'code' command."
  echo "Ensure VS Code is installed and the 'code' command is available in your PATH."
  exit 1
fi
echo "VS Code launched for directory."

# Wait for VS Code to potentially initialize
echo "Waiting ${VSCODE_URI_DELAY}s before triggering VS Code extension URI..."
sleep "$VSCODE_URI_DELAY"

# Move it from $TASK_FIELE_PATH to $PROJECT_DIR_PATH/.roo-trigger
mv $TASK_FILE_PATH $PROJECT_DIR_PATH/.roo-trigger

echo "Script finished."
exit 0